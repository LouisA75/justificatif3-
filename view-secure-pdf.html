<!DOCTYPE html>
       <html lang="fr">
       <head>
         <meta charset="UTF-8">
         <meta name="viewport" content="width=device-width, initial-scale=1.0">
         <title>Certificat Médical Sécurisé - Hébergement</title>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/5.11.2/openpgp.min.js"></script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.7.76/pdf.min.mjs" type="module"></script>
         <style>
           body { margin: 0; overflow: hidden; background-color: #1a1a1a; }
           #pdfViewer { width: 100%; height: 100vh; }
           #error { color: #ff4444; text-align: center; font-size: 18px; padding: 10px; }
           #instruction { text-align: center; color: white; padding: 10px; background-color: #333; }
           canvas { pointer-events: none; }
         </style>
       </head>
       <body>
         <div id="instruction">Document confidentiel. Visualisation sécurisée, fermeture dans 15 secondes.</div>
         <div id="pdfViewer"></div>
         <div id="error"></div>
         <script type="module">
           window.onbeforeprint = () => false;
           document.addEventListener('contextmenu', e => e.preventDefault());
           document.addEventListener('keydown', e => {
             if ((e.ctrlKey || e.metaKey) && (e.key === 's' || e.key === 'p')) {
               e.preventDefault();
             }
           });
           setTimeout(() => { window.close(); }, 15000);

           async function loadAndDisplayPDF() {
             try {
               const gpgUrl = '/certificat-medical-20250929.pdf.gpg';
               const passphrase = 'X7kP#nL4jQ8mZ&vT';

               const response = await fetch(gpgUrl);
               if (!response.ok) throw new Error('Erreur de chargement');
               const encryptedData = await response.arrayBuffer();

               const { data: decryptedData } = await openpgp.decrypt({
                 message: await openpgp.readMessage({ armoredMessage: new TextDecoder().decode(encryptedData) }),
                 passwords: [passphrase],
                 format: 'binary'
               });

               const pdf = await pdfjsLib.getDocument({ data: decryptedData }).promise;
               const viewer = document.getElementById('pdfViewer');

               for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                 const page = await pdf.getPage(pageNum);
                 const scale = 1.5;
                 const viewport = page.getViewport({ scale });
                 const canvas = document.createElement('canvas');
                 canvas.height = viewport.height;
                 canvas.width = viewport.width;
                 viewer.appendChild(canvas);
                 const context = canvas.getContext('2d');
                 await page.render({ canvasContext: context, viewport }).promise;
               }

               decryptedData.fill(0);
             } catch (error) {
               document.getElementById('error').textContent = 'Erreur : ' + error.message;
             }
           }

           loadAndDisplayPDF();
         </script>
       </body>
       </html>
