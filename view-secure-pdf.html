<!DOCTYPE html>
        <html lang="fr">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Visualisation Sécurisée du PDF</title>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/5.11.2/openpgp.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.7.76/pdf.min.mjs" type="module"></script>
          <style>
            body { margin: 0; overflow: hidden; }
            #pdfViewer { width: 100%; height: 100vh; }
            #error { color: red; text-align: center; font-size: 18px; }
            canvas { pointer-events: none; } /* Désactive les interactions avec le PDF */
          </style>
        </head>
        <body>
          <div id="pdfViewer"></div>
          <div id="error"></div>
          <script type="module">
            // Désactiver l'impression
            window.onbeforeprint = () => false;

            // Empêcher le clic droit et les raccourcis de téléchargement
            document.addEventListener('contextmenu', e => e.preventDefault());
            document.addEventListener('keydown', e => {
              if ((e.ctrlKey || e.metaKey) && (e.key === 's' || e.key === 'p')) {
                e.preventDefault();
              }
            });

            // Fermer la page après 15 secondes
            setTimeout(() => {
              window.close();
            }, 15000);

            async function loadAndDisplayPDF() {
              try {
                // Chemin relatif du fichier .gpg
                const gpgUrl = '/LAB-EXAMS-20250926-ICL-01-Q7P3-000001 (1)_protected.gpg';
                const passphrase = 'NnA7sfW#kteByD3wzfcEcY0p&wF'; // Mot de passe GPG

                // Télécharger le fichier .gpg
                const response = await fetch(gpgUrl);
                if (!response.ok) throw new Error('Erreur lors du chargement du fichier GPG');
                const encryptedData = await response.arrayBuffer();

                // Déchiffrer avec OpenPGP.js
                const { data: decryptedData } = await openpgp.decrypt({
                  message: await openpgp.readMessage({ armoredMessage: new TextDecoder().decode(encryptedData) }),
                  passwords: [passphrase],
                  format: 'binary'
                });

                // Charger le PDF avec PDF.js
                const pdf = await pdfjsLib.getDocument({ data: decryptedData }).promise;
                const viewer = document.getElementById('pdfViewer');

                // Afficher chaque page du PDF
                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                  const page = await pdf.getPage(pageNum);
                  const scale = 1.5;
                  const viewport = page.getViewport({ scale });
                  const canvas = document.createElement('canvas');
                  canvas.height = viewport.height;
                  canvas.width = viewport.width;
                  viewer.appendChild(canvas);
                  const context = canvas.getContext('2d');
                  await page.render({ canvasContext: context, viewport }).promise;
                }

                // Nettoyer la mémoire
                decryptedData.fill(0); // Remplir le buffer de zéros
              } catch (error) {
                document.getElementById('error').textContent = 'Erreur : ' + error.message;
              }
            }

            // Lancer le chargement
            loadAndDisplayPDF();
          </script>
        </body>
        </html>